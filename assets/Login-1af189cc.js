import{r as t,v as Y,f as J,e as $,a2 as m,a9 as O,an as q,ao as h,ap as Z,j as e,ab as f,N as Q,L as H,I as P,aq as ee,q as ne}from"./index-c9329193.js";import{u as se,t as oe}from"./zod-759f93f6.js";import{E as re}from"./error-3c144da9.js";import{R as te}from"./recaptcha-wrapper-ed08ea1d.js";import{O as g}from"./input-773f729a.js";import{H as ae}from"./Helmet-35a305b3.js";const ie="_login_ezv17_1",ce="_message_ezv17_11",_e="_errormessagecontainer_ezv17_18",le="_messagecontainer_ezv17_25",me="_left_ezv17_32",ue="_closeWrapper_ezv17_45",de="_card_ezv17_55",pe="_inputWrapper_ezv17_89",he="_rememberInfo_ezv17_95",fe="_right_ezv17_112",Ee="_buttonWrapper_ezv17_119",Te="_checkBox_ezv17_124",ge="_remeberInfo_ezv17_138",be="_top_ezv17_159",Ne="_info_ezv17_170",Re="_buttonWrapperOTP_ezv17_217",n={login:ie,message:ce,errormessagecontainer:_e,messagecontainer:le,left:me,closeWrapper:ue,card:de,inputWrapper:pe,rememberInfo:he,right:fe,buttonWrapper:Ee,checkBox:Te,remeberInfo:ge,top:be,info:Ne,"confirm-email":"_confirm-email_ezv17_198","button-group":"_button-group_ezv17_204",buttonWrapperOTP:Re},Ie=({email:E,code:b,setCode:r,handleClickTotp:_,handleClickOtp:u,otp:d,totp:i,step:s})=>(console.log(b,"code"),console.log(i,d,"111"),e.jsxs(e.Fragment,{children:[d&&!i&&e.jsxs("div",{className:n["confirm-email"],children:[e.jsx("h3",{children:"Check your email for a code"}),e.jsxs("p",{children:["We have sent a 6-digits code to ",E,". The code expires shortly, so please enter it soon."]}),e.jsxs("form",{onSubmit:u,children:[e.jsx(g,{setOTPCode:r,request:()=>u()}),e.jsx("div",{className:n["button-group"],children:e.jsx("div",{className:`${n.buttonWrapper} ${n.buttonWrapperOTP}`,children:e.jsx(f,{className:n.button,onClick:u,children:"Confirm"})})})]})]}),i&&!d&&e.jsxs("div",{className:n["confirm-email"],children:[e.jsx("h3",{children:"Enter code from your Authenticator"}),e.jsx("p",{children:"You need to enter 6-digit code from your Authenticator"}),e.jsxs("form",{onSubmit:_,children:[e.jsx(g,{setOTPCode:r,request:()=>_()}),e.jsx("div",{className:n["button-group"],children:e.jsx("div",{className:`${n.buttonWrapper} ${n.buttonWrapperOTP}`,children:e.jsx(f,{className:n.button,onClick:_,children:"Confirm"})})})]})]}),i&&d&&e.jsx(e.Fragment,{children:s?e.jsxs("div",{className:n["confirm-email"],children:[e.jsx("h3",{children:"Enter code from your Authenticator"}),e.jsx("p",{children:"You need to enter 6-digit code from your Authenticator"}),e.jsxs("form",{id:"totpForm",onSubmit:_,children:[e.jsx(g,{setOTPCode:r,resetCodeFlag:!0,request:()=>_()}),e.jsx("div",{className:n["button-group"],children:e.jsx("div",{className:`${n.buttonWrapper} ${n.buttonWrapperOTP}`,children:e.jsx(f,{className:n.button,onClick:_,children:"Confirm"})})})]})]}):e.jsxs("div",{className:n["confirm-email"],children:[e.jsx("h3",{children:"Check your email for a code"}),e.jsxs("p",{children:["We have sent a 6-digits code to ",E,". The code expires shortly, so please enter it soon."]}),e.jsxs("form",{onSubmit:u,children:[e.jsx(g,{setOTPCode:r,request:()=>u()}),e.jsx("div",{className:n["button-group"],children:e.jsx("div",{className:`${n.buttonWrapper} ${n.buttonWrapperOTP}`,children:e.jsx(f,{className:n.button,onClick:u,children:"Confirm"})})})]})]})})]})),Oe=()=>{var v,U;const E=t.useRef(),[b,r]=t.useState(null),[_,u]=t.useState(null),d=Y(),i=new J,{t:s}=$(),[p,C]=t.useState(m.get("nefentus-remember-me")?JSON.parse(m.get("nefentus-remember-me")):!1),D=O.object({email:O.string().min(1,{message:s("messages.validation.email")}),password:O.string().min(1,{message:s("messages.validation.password")})}),{register:A,handleSubmit:G,getValues:N,formState:{errors:x}}=se({resolver:oe(D),mode:"onSubmit",defaultValues:{email:m.get("nefentus-username")?m.get("nefentus-username"):"",password:m.get("nefentus-password")?q(m.get("nefentus-password")):""}});t.useEffect(()=>{p?(h("nefentus-username",N("email"),365),h("nefentus-password",Z(N("password")),365),h("nefentus-remember-me",p,365)):(h("nefentus-username","",365),h("nefentus-password","",365),h("nefentus-remember-me",!1,365))},[p,N]);const[B,k]=t.useState(!1),[R,L]=t.useState(null),[I,w]=t.useState(""),[j,M]=t.useState(!1),[S,W]=t.useState(!1),[y,V]=t.useState(!1);function T(){const o=ne(localStorage);d(o)}t.useEffect(()=>{const o=new URLSearchParams(window.location.search);if(o.has("token")){const l=o.get("token");K(l)}async function c(){await i.checkJwt()&&T()}c()},[]);async function F(o,c){if(!E.current.getValue())r(s("messages.error.reCAPTCHA"));else{m.get("acceptCookie")!==!0&&(c=!1);try{const a=await i.login(o.email,o.password,c);if(a==null){r(s("messages.error.loginData"));return}else a.hasOtp||a.hasTotp?(k(!0),M(a.hasOtp),W(a.hasTotp),L(a.email)):T()}catch{r(s("messages.error.login"))}}}async function z(o,c,l){m.get("acceptCookie")!==!0&&(l=!1);try{if(await i.verifyOTP(o,c,l)==null){r(s("messages.error.confirm"));return}j&&S?V(!0):T()}catch{r(s("messages.error.login"))}}async function X(o,c,l){m.get("acceptCookie")!==!0&&(l=!1);const a=await i.verifyTotpToken(o,c,l);try{if(a==null){r("Failed to Confirm");return}T()}catch{r(s("messages.error.login"))}}const K=async o=>{try{if(await i.activateAccount(o)==null){r(s("messages.error.activateAccount"));return}u(s("messages.success.activateAccount"))}catch{r(s("messages.error.activateAccount"))}};return e.jsxs("div",{className:`${n.login}`,children:[e.jsx("div",{className:n.closeWrapper,children:e.jsx(f,{link:"/",color:"white",children:s("login.close")})}),e.jsxs("div",{className:n.left,children:[e.jsx(Q,{}),e.jsxs("div",{children:[e.jsx("h2",{children:e.jsx("span",{className:"gradient",children:s("login.titleP1")})}),e.jsx("p",{children:s("login.description")}),e.jsxs("p",{children:[s("login.info"),e.jsx("u",{children:e.jsx(H,{to:"/signUp",children:s("login.infoButton")})})]})]})]}),e.jsxs("div",{className:n.right,children:[e.jsx(re,{error:b||((v=x.email)==null?void 0:v.message)||((U=x.password)==null?void 0:U.message)}),_&&e.jsx("div",{className:n.messagecontainer,children:e.jsx("p",{children:_})}),B?e.jsx(Ie,{email:R,code:I,setCode:w,handleClickOtp:()=>z(R,I,p),handleClickTotp:()=>X(R,I,p),otp:j,totp:S,step:y}):e.jsxs("form",{onSubmit:G(F),children:[e.jsxs("div",{className:n.inputWrapper,children:[e.jsx(P,{register:A,name:"email",label:s("signUp.emailLabel")+"*",placeholder:s("signUp.emailPlaceholder")}),e.jsx(P,{register:A,name:"password",label:s("signUp.passwordLabel")+"*",placeholder:s("signUp.passwordPlaceholder"),secure:!0}),e.jsx(te,{ref:E,sitekey:"6Leb6H8oAAAAAM0q25gltEqlMOUUymzoDobq4NLc",theme:"dark"}),e.jsxs("div",{className:n.rememberInfo,children:[e.jsxs("div",{onClick:()=>C(o=>!o),children:[e.jsx("div",{className:n.checkBox,children:p&&e.jsx(ee,{})}),e.jsx("p",{children:s("login.remember")})]}),e.jsx(H,{to:"/forgot-password",children:e.jsx("p",{children:s("login.forgot")})})]})]}),e.jsx("div",{className:n.buttonWrapper,children:e.jsx(f,{className:n.button,type:"submit",children:s("login.button")})})]})]})]})},Pe=()=>e.jsxs("div",{className:"dashboardFont",children:[e.jsx(ae,{children:e.jsx("title",{children:"Nefentus | Login"})}),e.jsx(Oe,{})]});export{Pe as default};

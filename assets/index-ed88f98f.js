import{r as f,j as a,u as S,e as q,a as z,b as D,m as O,c as Z,d as G,M as J,f as K,i as W,a8 as Q,ab as p,g as V,h as X,au as Y,I as U,av as g}from"./index-ceef141d.js";import{u as aa,T as B}from"./topInfo-cfd8bee6.js";import{M as sa}from"./modalOverlay-74fc3d71.js";import{u as ea,w as ta}from"./topInfo.module-430656a7.js";import{c as v}from"./constants-3a7ec10a.js";const na="_container_aapa9_1",oa="_infoWrapper_aapa9_20",ca="_productInfo_aapa9_25",ra="_productImage_aapa9_30",la="_imageWrapper_aapa9_35",ia="_image_aapa9_35",da="_body_aapa9_50",ma="_productBuy_aapa9_54",ua="_price_aapa9_65",pa="_stock_aapa9_66",_a="_tabNavLogo_aapa9_78",ba="_tabContent_aapa9_84",fa="_center_aapa9_92",xa="_balance_aapa9_97",ja="_table_aapa9_105",Na="_line_aapa9_120",ga="_lineLeft_aapa9_134",ha="_name_aapa9_140",va="_dollar_aapa9_141",ya="_abbr_aapa9_146",ka="_crypto_aapa9_147",Ba="_modalInputs_aapa9_157",Ia="_modalButtons_aapa9_162",s={container:na,infoWrapper:oa,productInfo:ca,productImage:ra,imageWrapper:la,image:ia,body:da,productBuy:ma,price:ua,stock:pa,tabNavLogo:_a,tabContent:ba,center:fa,balance:xa,table:ja,line:Na,lineLeft:ga,name:ha,dollar:va,abbr:ya,crypto:ka,modalInputs:Ba,modalButtons:Ia},Ca="_tabBody_18ti8_1",Ma="_tabNav_18ti8_6",wa="_tabNavItem_18ti8_13",k={tabBody:Ca,tabNav:Ma,tabNavItem:wa},Aa=({tabIds:n,initActiveTab:l,getHeader:o,getBody:u,beforeChangeTab:i})=>{const[r,e]=f.useState(l);return a.jsxs("div",{className:`${k.tabBody} card`,children:[a.jsx("div",{className:k.tabNav,children:n.map(c=>a.jsx("div",{className:k.tabNavItem,onClick:()=>{i&&i(c),e(c)},style:{borderColor:r===c?"#fff":"transparent",color:r===c?"#fff":"#c4c4c4"},children:o(c)},c))}),u(r)]})},Pa="/nefentus/assets/logo_n-476813c9.png",Ha=({priceUSD:n,userId:l,info:o,transInfoArg:u,disabled:i})=>{let r=S();const{t:e}=q(),[c,L]=f.useState(""),[I,C]=f.useState(-1),t={connect:z(),disconnect:D(),config:O(),address:Z(),status:G()};console.log("MetaMask status: "+t.status),console.log("MetaMask address: "+t.address);const{balances:M,fetchBalances:E}=ea(t),{prices:w,fetchPrices:F}=aa(t),{setInfoMessage:y,setErrorMessage:x,clearMessages:$}=f.useContext(J),h=new K;f.useEffect(()=>{$()},[]),f.useEffect(()=>{F(),E(),t.status==="connected"&&t.address&&H()},[t.status,t.address]);async function H(){await h.registerWalletAddress(t.address)}async function A(d,_){if(!(n>0)){x(e("messages.error.invalidPrice"));return}if(!l){x(e("messages.error.invalidUserId"));return}const m=v[1].address,P=1;if(d==="metamask"){const j=new ta(d),b=await h.getHierarchy(l);console.log(b);const N=await j.callDepositContract(g(b.sellerAddress),g(b.affiliateAddress),g(b.brokerAddress),g(b.seniorBrokerAddress),g(b.leaderAddress),m,n);if(N){N.quantity=P,N.totalPrice=n,j.convertBigIntToString(N);const R=await h.setTransactionInfo(N,t.address,u);y(R?e("messages.success.transaction"):"Transaction successfully but could not send transaction info!")}else x(e("messages.error.transactionFailed"))}else if(d==="internal"){const j=await h.makePayment(null,n,P,c,m,u);j==="insufficientFunds"?x(e("messages.error.transactionFailed2")):j?y(e("messages.success.transaction")):x(e("messages.error.transactionFailed"))}}return a.jsxs("div",{className:s.container,children:[a.jsx(W,{}),a.jsx("div",{className:s.infoWrapper,children:o}),i&&a.jsx("div",{className:`card ${s.productBuy}`,children:a.jsx("div",{className:s.body,children:a.jsx(B,{title:"Buy product",description:"This product is currently unavailable."})})}),!i&&a.jsx("div",{className:`card ${s.productBuy}`,children:a.jsxs("div",{className:s.body,children:[a.jsx(B,{title:e("products.topInfoTitle"),description:e("products.topInfoDescription")}),a.jsx(Aa,{tabIds:["internal","metamask"],initActiveTab:"internal",getHeader:d=>{if(d==="metamask")return a.jsxs(a.Fragment,{children:[a.jsx("img",{src:Q,className:s.tabNavLogo,alt:"MetaMask Wallet"})," ","MetaMask"]});if(d==="internal")return a.jsxs(a.Fragment,{children:[a.jsx("img",{src:Pa,className:s.tabNavLogo,alt:"Nefentus Wallet"})," ","Nefentus Wallet"]})},getBody:d=>{if(d==="metamask")return a.jsxs("div",{className:s.tabContent,children:[t.status==="connected"&&a.jsx("div",{className:s.table,children:v.map((_,m)=>a.jsx(T,{currency:_,balance:M[0][m],price:w[m],priceProduct:n,onClick:()=>{A("metamask")}},_.abbr))}),t.status==="disconnected"&&a.jsx("div",{className:s.center,children:a.jsxs(p,{className:s.metamaskConnectButton,onClick:()=>t.connect(t.config,{chainId:1}),children:[e("products.connect"),"MetaMask"]})}),t.status==="unknown"&&a.jsx("div",{className:s.center,children:a.jsxs(p,{className:s.metamaskConnectButton,disabled:!0,children:["MetaMask",e("products.notAvailable")]})}),t.status==="connecting"&&a.jsx("div",{className:s.center,children:a.jsx(p,{className:s.metamaskConnectButton,disabled:!0,children:e("products.connecting")})})]});if(d==="internal")return a.jsxs("div",{className:s.tabContent,children:[!r&&a.jsx("div",{className:s.center,children:a.jsxs(p,{className:s.nefentusLoginButton,onClick:()=>{},children:[e("products.login"),"Nefentus"]})}),r&&a.jsx("div",{className:s.table,children:v.map((_,m)=>a.jsx(T,{currency:_,balance:M[1][m],price:w[m],priceProduct:n,onClick:()=>{C(m)}},_.abbr))})]})},beforeChangeTab:()=>{}})]})}),I>=0&&a.jsx(Ta,{price:n,currencyAbbr:v[I].abbr,onClose:()=>C(-1),onPay:()=>A("internal"),password:c,setPassword:L})]})},T=({balance:n,price:l,currency:o,priceProduct:u,onClick:i})=>{let r="loading",e="loading";n&&(r=n,l&&(e=n*l));let c=!1;return e&&(c=e>u&&o.abbr==="ETH"),a.jsxs("div",{className:s.line,children:[a.jsxs("div",{className:s.lineLeft,children:[a.jsx("img",{src:o.icon,className:s.icon,alt:""}),a.jsxs("div",{children:[a.jsx("p",{className:s.name,children:o.name}),a.jsx("p",{className:s.abbr,children:o.abbr})]})]}),a.jsxs("div",{className:s.amounts,children:[a.jsxs("p",{className:s.dollar,children:["â‰ˆ ",V(e)," USD"]}),a.jsxs("p",{className:s.crypto,children:[X(r,o.decimals)," ",o.abbr]})]}),a.jsx("div",{className:s.actions,children:c&&a.jsx(p,{className:s.buyButton,onClick:i,color:"white",children:"Pay"})})]})},Ta=({price:n,currencyAbbr:l,onClose:o,onPay:u,password:i,setPassword:r})=>a.jsx(sa,{children:a.jsxs("div",{className:s.modal,children:[a.jsx(W,{}),a.jsx(B,{title:"Password",description:"Type in your password to pay with your Nefentus wallet"}),a.jsx(Y,{data:[["Amount:",`${n} USD`],["Currency:",l]],colSizes:[1,3]}),a.jsx("div",{className:s.modalInputs,children:a.jsx(U,{label:"Password",placeholder:"Enter password",dashboard:!0,value:i,setState:r,secure:!0})}),a.jsxs("div",{className:s.modalButtons,children:[a.jsx(p,{onClick:o,color:"black",children:"Close"}),a.jsx(p,{onClick:u,color:"white",children:"Pay"})]})]})});export{Ha as R};
